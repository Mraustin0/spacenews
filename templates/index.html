<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>nasa news explorer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=The+Seasons:wght@400;700&display=swap" rel="stylesheet">
<style>
/* Base */
* { margin:0; padding:0; box-sizing:border-box; }
body { 
    font-family: 'Inter', Arial, Helvetica, sans-serif; 
    background: #080b11; 
    color: #eaeaea; 
    line-height:1.5; 
    -webkit-font-smoothing: antialiased;
}

a { color: #ff6666; text-decoration:none; transition: color 0.3s ease; }
a:hover { text-decoration: underline; color: #fff; }

/* Typography */
h1, h2, h3, h4 {
    font-family: 'The Seasons', serif;
    font-weight: 600;
    text-transform: lowercase;
}

/* Navigation */
nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(18, 20, 28, 0.92);
    backdrop-filter: blur(14px);
    padding: 16px 32px;
    position: sticky;
    top: 0;
    z-index: 120;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.breadcrumb {
    max-width: 1200px;
    margin: 24px auto 0 auto;
    padding: 0 32px;
    font-size: 12px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}
.breadcrumb a {
    color: rgba(245, 245, 245, 0.55);
    text-decoration: none;
    transition: color 0.2s ease;
}
.breadcrumb a:hover {
    color: #ffffff;
}
.breadcrumb span {
    color: #ffffff;
    font-weight: 600;
}

.site-footer {
    margin-top: 60px;
    padding: 28px 16px;
    border-top: 1px solid rgba(255,255,255,0.08);
    text-align: center;
    color: rgba(245,245,245,0.6);
    font-size: 13px;
    letter-spacing: 0.05em;
}
.site-footer a {
    color: rgba(245,245,245,0.75);
    text-decoration: none;
}
.site-footer a:hover {
    color: #f87171;
}
.nav-left,
.nav-center,
.nav-right {
    display: flex;
    align-items: center;
}
.nav-left {
    gap: 12px;
}
.nav-left img {
    height: 28px;
}
.nav-left .logo {
    font-family: 'The Seasons', serif;
    font-size: 18px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #f5f5f5;
    text-decoration: none;
}
.nav-center {
    gap: 24px;
}
.nav-center a {
    color: rgba(245, 245, 245, 0.84);
    text-decoration: none;
    font-size: 14px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-weight: 500;
    transition: color 0.2s ease;
}
.nav-center a:hover,
.nav-center a.active {
    color: #f87171;
}
.dropdown {
    position: relative;
}
.dropbtn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
}
.dropbtn::after {
    content: '\25BE';
    font-size: 11px;
    transition: transform 0.2s ease;
}
.dropdown:hover .dropbtn::after {
    transform: rotate(-180deg);
}
.dropdown-content {
    position: absolute;
    top: calc(100% + 10px);
    left: 0;
    background: rgba(14, 16, 24, 0.96);
    border-radius: 14px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    min-width: 190px;
    padding: 10px 0;
    box-shadow: 0 18px 36px rgba(0,0,0,0.45);
    opacity: 0;
    visibility: hidden;
    transform: translateY(8px);
    transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
    z-index: 200;
}
.dropdown:hover .dropdown-content {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}
.dropdown-content a {
    display: block;
    padding: 10px 18px;
    color: rgba(245,245,245,0.78);
    text-decoration: none;
    font-size: 12px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    transition: background 0.2s ease, color 0.2s ease;
}
.dropdown-content a:hover {
    background: rgba(248,113,113,0.12);
    color:#f87171;
}
.nav-right {
    gap: 16px;
}
.nav-right span {
    color: rgba(245,245,245,0.68);
    font-size: 13px;
    letter-spacing: 0.05em;
}
.nav-right a {
    color: rgba(245,245,245,0.84);
    text-decoration: none;
    font-size: 14px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    font-weight: 500;
    padding: 8px 18px;
    border-radius: 999px;
    border: 1px solid transparent;
    transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
}
.nav-right a:hover {
    border-color: rgba(248,113,113,0.6);
    color: #f87171;
}
.nav-right .primary-action {
    border-color: rgba(248,113,113,0.65);
    color: #f87171;
}
.nav-right .primary-action:hover {
    background: #f87171;
    color: #111;
}

@media (max-width: 900px) {
    nav {
        flex-direction: column;
        align-items: flex-start;
        gap: 18px;
    }
    .nav-center, .nav-right {
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
    }
    .nav-right {
        justify-content: flex-end;
    }
}

/* Main Grid */
.main-content { max-width:1400px; margin:20px auto; padding:0 20px; }
.content-grid { display:grid; grid-template-columns:1fr 2fr 1fr; gap:20px; }

/* Cards */
.card { 
    background: linear-gradient(135deg, #191c22 0%, #22232b 100%);
    padding:15px; 
    border-radius:8px; 
    border:1px solid #222; 
    margin-bottom:20px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.28);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: default;
}
.card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}
.card img { 
    width:100%; 
    border-radius:4px; 
    margin-bottom:10px; 
    object-fit: cover; 
    height: 150px; 
    transition: transform 0.3s ease;
}
.card img:hover {
    transform: scale(1.02);
}
.card h3 { 
    margin-bottom:10px; 
    font-size:16px; 
    color:#fff; 
    font-family: 'Inter', Arial, Helvetica, sans-serif;
    font-weight: 600; 
    text-transform: none;
}
.card p { 
    font-size:14px; 
    color:#d8d8d8; 
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;  
    overflow: hidden;
    text-overflow: ellipsis;
}
.loading { 
    font-style:italic; 
    color:#ff6666; 
    text-transform: lowercase;
}

/* Enhanced Stats */
.stats { 
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.stat-item { 
    background: rgba(24, 24, 28, 0.95);
    padding: 24px 16px;
    border-radius: 12px;
    border: 1px solid #23232c;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #ff6666, #b22222);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.stat-item:hover::before {
    transform: scaleX(1);
}

.stat-item:hover {
    background: #18181e;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    transform: translateY(-2px);
}

.stat-item strong { 
    display: block;
    font-size: 18px;
    font-weight: 700;
    color: #ff6666;
    margin-bottom: 8px;
    text-transform: lowercase;
}

.stat-item span { 
    font-size: 12px;
    color: #aaa;
    font-weight: 500;
    text-transform: lowercase;
    letter-spacing: 0.5px;
}

/* Left Column Scrollable */
.left-column {
    max-height: 800px;
    overflow-y: auto;
    padding-right: 8px;
}

.left-column::-webkit-scrollbar {
    width: 6px;
}

.left-column::-webkit-scrollbar-track {
    background: transparent;
}

.left-column::-webkit-scrollbar-thumb {
    background: #ddd;
    border-radius: 3px;
}

.left-column::-webkit-scrollbar-thumb:hover {
    background: #bbb;
}

/* Center Column Layout */
.center-column {
    display: flex;
    flex-direction: column;
    gap: 32px;
    max-height: 800px;
    overflow-y: auto;
    padding-right: 8px;
}

.center-column::-webkit-scrollbar {
    width: 6px;
}

.center-column::-webkit-scrollbar-track {
    background: transparent;
}

.center-column::-webkit-scrollbar-thumb {
    background: #ddd;
    border-radius: 3px;
}

.center-column::-webkit-scrollbar-thumb:hover {
    background: #bbb;
}

/* Right Column Enhancements */
.right-column .card {
    margin-bottom: 24px;
    padding: 20px 18px;
    border-radius: 14px;
    border: 1px solid rgba(255, 255, 255, 0.06);
    background: rgba(20, 24, 34, 0.92);
    box-shadow: 0 14px 32px rgba(0,0,0,0.28);
}

.right-column .card h3 {
    font-size: 14px;
    margin-bottom: 12px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-family: 'Inter', Arial, Helvetica, sans-serif;
    font-weight: 600;
    color: #f5f5f5;
}

.right-column .card p {
    font-size: 14px;
    margin-bottom: 0;
    line-height: 1.6;
    color: rgba(245,245,245,0.85);
}

/* News Card Specific */
.news-card {
    transition: all 0.3s ease;
    cursor: pointer;
}

.news-card:hover {
    background: #23232b;
}

.news-card h3 {
    color: #fff;
    margin-bottom: 12px;
    font-size: 16px;
    font-family: 'Inter', Arial, Helvetica, sans-serif;
    font-weight: 600;
}

.news-card p {
    color: #d8d8d8;
    margin-bottom: 12px;
}

.news-card a {
    font-size: 12px;
    text-transform: none;
    font-weight: 500;
    color: #ff6666;
}
.news-card a:hover {
    color: #fff;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .content-grid {
        grid-template-columns: 300px 1fr 280px;
        gap: 30px;
    }
    
    .main-content {
        padding: 0 30px;
    }
}

@media (max-width: 992px) {
    .content-grid {
        grid-template-columns: 1fr;
        gap: 30px;
    }
    
    .nav-center {
        flex-wrap: wrap;
        gap: 20px;
    }
    
    nav {
        padding: 15px 20px;
    }
    
    .main-content {
        padding: 0 20px;
        margin: 20px auto;
    }
}

@media (max-width: 768px) {
    .navbar {
        flex-direction: column;
        gap: 20px;
        padding: 20px;
    }
    
    .nav-left, .nav-center, .nav-right {
        flex: none;
        width: 100%;
        text-align: center;
    }
    
    .nav-center {
        justify-content: center;
    }
    
    .card {
        padding: 24px;
        margin-bottom: 24px;
    }
    
    .stats {
        grid-template-columns: 1fr;
        gap: 12px;
    }
}

/* Loading text */
.loading {
    color: rgba(245,245,245,0.8);
}

/* Enhanced focus states for accessibility */
button:focus, input:focus, a:focus {
    outline: 2px solid #8b0000;
    outline-offset: 2px;
}
</style>
</head>
<body>

<!-- Global Navbar -->
<nav>
    <div class="nav-left">
        <img src="https://upload.wikimedia.org/wikipedia/commons/e/e5/NASA_logo.svg" alt="NASA Logo">
        <a href="{{ url_for('index') }}" class="logo">SpaceNews</a>
    </div>
    <div class="nav-center">
        <a href="{{ url_for('index') }}" class="active">Home</a>
        <div class="dropdown">
            <a href="{{ url_for('apod_page') }}" class="dropbtn">APOD</a>
            <div class="dropdown-content">
                <a href="{{ url_for('apod_page') }}">APOD</a>
                <a href="{{ url_for('apod_gallery_page') }}">APOD Gallery</a>
            </div>
        </div>
        <a href="{{ url_for('mars_gallery') }}">Mars Gallery</a>
        <a href="{{ url_for('my_gallery') }}">My Gallery</a>
    </div>
    <div class="nav-right">
        {% if current_user %}
        <span>Hello, {{ current_user.username }}</span>
        <a href="{{ url_for('logout') }}">LOG OUT</a>
        {% else %}
        <a href="{{ url_for('login') }}">LOG IN</a>
        <a href="{{ url_for('register') }}" class="primary-action">Register</a>
        {% endif %}
    </div>
</nav>

<div class="breadcrumb">
    <a href="{{ url_for('index') }}">Home</a>
    <span>/</span>
    <span>Home</span>
</div>

<main class="main-content">
    <div class="content-grid">
        <!-- Enhanced Left Column -->
        <div class="left-column" id="left-placeholder">
            <div class="card">
                <h3>Archive News</h3>
                <div id="older-news-list">
                    <p class="loading">loading archive news...</p>
                </div>
            </div>
        </div>

        <!-- Enhanced Center Column -->
        <div class="center-column">
            <div class="card">
                <h3>Featured Space Stories</h3>
                <div class="latest-news-list" id="latest-news-list">
                    <p class="loading">loading latest discoveries...</p>
                </div>
            </div>
        </div>

        <!-- Enhanced Right Column -->
        <div class="right-column">
            <div class="card">
                <h3>mars weather</h3>
                <p id="mars-weather" class="loading">connecting to mars...</p>
            </div>
            
            <div class="card">
                <h3>near earth objects</h3>
                <p id="neo-count" class="loading">scanning for asteroids...</p>
            </div>
            
            <div class="card">
                <h3>mission statistics</h3>
                <div class="stats">
                    <div class="stat-item">
                        <strong id="active-missions">73</strong>
                        <span>active missions</span>
                    </div>
                    <div class="stat-item">
                        <strong id="planets-explored">8</strong>
                        <span>planets explored</span>
                    </div>
                    <div class="stat-item">
                        <strong id="satellites-active">2,847</strong>
                        <span>satellites active</span>
                    </div>
                    <div class="stat-item">
                        <strong id="years-exploration">65</strong>
                        <span>years exploring</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer class="site-footer">
    <p>© 2024 SpaceNew — data courtesy of NASA & Spaceflight News APIs.</p>
</footer>

<script>
const apiKey = 'Nck2yzPgvBPyrIXPkxS8Q5fos91gn09A2fX3ZsS4';
const PLACEHOLDER_IMG = 'https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?w=400&h=250&fit=crop';

const latestNewsList = document.getElementById('latest-news-list');
const olderNewsList = document.getElementById('older-news-list');

function truncateText(text, maxLength) {
    if(text.length > maxLength){
        return text.substring(0, maxLength - 3) + '...';
    }
    return text;
}

function createArticleCard(article, isLatest = false) {
    const title = article.title || 'Untitled story';
    const summary = truncateText(article.summary || '', isLatest ? 260 : 140);
    const link = article.url || '#';
    const published = article.published_at ? new Date(article.published_at).toLocaleDateString(undefined, {
        year: 'numeric', month: 'short', day: 'numeric'
    }) : '';

    const imageUrl = article.image_url || PLACEHOLDER_IMG;

    const card = document.createElement('div');
    card.classList.add('card', 'news-card');
    card.innerHTML = `
        <img src="${imageUrl}" alt="${title}" loading="lazy">
        <h3>${title}</h3>
        <p>${summary}</p>
        <a href="${link}" target="_blank" rel="noopener noreferrer">Read full article →</a>
        <small style="display:block;margin-top:8px;color:rgba(245,245,245,0.55);letter-spacing:0.05em;text-transform:uppercase;">${published}</small>
    `;

    card.addEventListener('click', (e) => {
        if (e.target.tagName !== 'A') {
            window.open(link, '_blank', 'noopener,noreferrer');
        }
    });

    return card;
}

async function fetchAndDisplayNews() {
    latestNewsList.innerHTML = '<p class="loading">loading latest discoveries...</p>';
    olderNewsList.innerHTML = '<p class="loading">loading archive...</p>';
    
    try {
        const response = await fetch('https://api.spaceflightnewsapi.net/v4/articles/?limit=12&offset=0');
        const data = await response.json();
        const items = data.results || [];

        if(items.length === 0){
            latestNewsList.innerHTML = '<p>no discoveries available at this time.</p>';
            olderNewsList.innerHTML = '<p>no archive available.</p>';
            return;
        }

        // Latest 3 featured stories
        const latestItems = items.slice(0, 3);
        latestNewsList.innerHTML = '';
        latestItems.forEach(item => {
            const card = createArticleCard(item, true);
            latestNewsList.appendChild(card);
        });

        // Archive stories
        const olderItems = items.slice(3, 15); // Limit to prevent too many
        olderNewsList.innerHTML = '';
        if(olderItems.length === 0){
            olderNewsList.innerHTML = '<p>no archive stories available.</p>';
            return;
        }
        olderItems.forEach(item => {
            const card = createArticleCard(item, false);
            olderNewsList.appendChild(card);
        });
    } catch (error) {
        latestNewsList.innerHTML = '<p>unable to load discoveries. please try again later.</p>';
        olderNewsList.innerHTML = '<p>archive temporarily unavailable.</p>';
        console.error('Error fetching news:', error);
    }
}

// Load Mars Weather from NASA InSight API (via backend)
async function loadMarsWeather() {
    const weatherEl = document.getElementById('mars-weather');
    if (!weatherEl) {
        return;
    }

    weatherEl.innerHTML = '<span class="loading">contacting nasa insight...</span>';

    try {
        const response = await fetch('/api/mars-weather');
        const payload = await response.json();

        if (!response.ok || !payload.success) {
            throw new Error(payload.error || 'Request failed');
        }

        const rawData = payload.data || {};
        let solKeys = Array.isArray(rawData.sol_keys) ? rawData.sol_keys.slice() : [];

        if (solKeys.length === 0) {
            solKeys = Object.keys(rawData).filter(key => /^\d+$/.test(key));
        }

        if (solKeys.length === 0) {
            throw new Error('No sol data available');
        }

        solKeys.sort((a, b) => Number(a) - Number(b));
        const latestSolKey = solKeys[solKeys.length - 1];
        const solData = rawData[latestSolKey];

        if (!solData) {
            throw new Error('Latest sol missing');
        }

        const temp = solData.AT && solData.AT.av;
        const pressure = solData.PRE && solData.PRE.av;
        const wind = solData.HWS && solData.HWS.av;

        const formatValue = (value, unit) => {
            const numeric = Number(value);
            if (!Number.isFinite(numeric)) {
                return 'N/A';
            }
            if (unit === '°C') {
                return `${numeric.toFixed(1)}${unit}`;
            }
            if (unit === 'Pa') {
                return `${Math.round(numeric)} ${unit}`;
            }
            if (unit === 'm/s') {
                return `${numeric.toFixed(1)} ${unit}`;
            }
            return `${numeric}${unit}`;
        };

        const lastUpdated = rawData.validity_checks && rawData.validity_checks[latestSolKey] && rawData.validity_checks[latestSolKey].sol_hours_required;

        weatherEl.innerHTML = `
            <strong>sol ${latestSolKey} report:</strong><br>
            temperature: ${formatValue(temp, '°C')}<br>
            pressure: ${formatValue(pressure, 'Pa')}<br>
            wind speed: ${formatValue(wind, 'm/s')}<br>
            <small>source: nasa insight mission${lastUpdated ? ', validated' : ''}</small>
        `;
    } catch (error) {
        console.error('Error loading Mars weather:', error);
        weatherEl.innerHTML = `
            <strong>mars weather unavailable</strong><br>
            <small>nasa insight data cannot be reached right now.</small>
        `;
    }
}

// Load Near Earth Objects from NASA NeoWs API (via backend)
async function loadNearEarthObjects() {
    const neoEl = document.getElementById('neo-count');
    if (!neoEl) {
        return;
    }

    neoEl.innerHTML = '<span class="loading">scanning nasa neo feed...</span>';

    try {
        const response = await fetch('/api/neo');
        const payload = await response.json();

        if (!response.ok || !payload.success) {
            throw new Error(payload.error || 'Request failed');
        }

        const rawData = payload.data || {};
        const objectsByDate = rawData.near_earth_objects || {};
        const dateKeys = Object.keys(objectsByDate);

        if (dateKeys.length === 0) {
            throw new Error('No NEO data available');
        }

        dateKeys.sort();
        const todayKey = dateKeys[dateKeys.length - 1];
        const todaysObjects = objectsByDate[todayKey] || [];

        const totalObjects = todaysObjects.length;

        let closestObject = null;
        let minDistance = Number.POSITIVE_INFINITY;

        todaysObjects.forEach(object => {
            const approach = (object.close_approach_data || [])[0];
            if (!approach) {
                return;
            }
            const missKm = parseFloat(approach.miss_distance && approach.miss_distance.kilometers);
            if (Number.isFinite(missKm) && missKm < minDistance) {
                minDistance = missKm;
                closestObject = {
                    name: object.name,
                    missKm,
                    velocity: parseFloat(approach.relative_velocity && approach.relative_velocity.kilometers_per_hour),
                    hazard: object.is_potentially_hazardous_asteroid
                };
            }
        });

        const formatDistance = km => `${(km / 1_000_000).toFixed(2)} million km`;
        const formatVelocity = v => (Number.isFinite(v) ? `${Math.round(v).toLocaleString()} km/h` : 'N/A');

        neoEl.innerHTML = `
            <strong>${totalObjects} objects detected (${todayKey})</strong><br>
            ${closestObject ? `closest: ${closestObject.name}<br>distance: ${formatDistance(closestObject.missKm)}<br>speed: ${formatVelocity(closestObject.velocity)}<br><small>${closestObject.hazard ? 'potentially hazardous' : 'no threat detected'}</small>` : '<small>no close approaches today</small>'}
        `;
    } catch (error) {
        console.error('Error loading NEO data:', error);
        neoEl.innerHTML = `
            <strong>neo feed unavailable</strong><br>
            <small>unable to reach nasa near earth object service.</small>
        `;
    }
}

// Initialize
fetchAndDisplayNews();
loadMarsWeather();
loadNearEarthObjects();

// Auto-refresh data every 30 minutes
setInterval(() => {
    fetchAndDisplayNews();
    loadMarsWeather();
    loadNearEarthObjects();
}, 30 * 60 * 1000);

</script>
</body>
</html>
